import{S as fe,i as de,s as _e,e as oe,a as O,n as Z,d as N,o as pe,b as be,c as d,t as w,f as c,g as j,h as u,j as x,k as I,l as me,m as U,p as re,q as Oe,r as ce,u as ie,v as Ne,w as Ie,x as ke,y as Ce,z as Re,A as Ae}from"./vendor.9b52e323.js";const Le=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerpolicy&&(n.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?n.credentials="include":l.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(l){if(l.ep)return;l.ep=!0;const n=e(l);fetch(l.href,n)}};Le();function we(r){let t,e,o,l;return{c(){t=d("div"),e=w(`Connecting\r
		`),o=d("tt"),l=w(r[1])},m(n,s){O(n,t,s),c(t,e),c(t,o),c(o,l)},p(n,s){s&2&&j(l,n[1])},d(n){n&&N(t)}}}function We(r){let t,e;return{c(){t=d("div"),e=w(r[0])},m(o,l){O(o,t,l),c(t,e)},p(o,l){l&1&&j(e,o[0])},d(o){o&&N(t)}}}function De(r){let t;function e(n,s){return n[0]?We:we}let o=e(r),l=o(r);return{c(){l.c(),t=oe()},m(n,s){l.m(n,s),O(n,t,s)},p(n,[s]){o===(o=e(n))&&l?l.p(n,s):(l.d(1),l=o(n),l&&(l.c(),l.m(t.parentNode,t)))},i:Z,o:Z,d(n){l.d(n),n&&N(t)}}}let Fe=null;function Be(r,t,e){let{connectionError:o}=t,l="|",n=0;return pe(()=>{setInterval(()=>{const s="|/-\\";n=(n+1)%s.length,e(1,l=s[n])},100)}),be(()=>{clearInterval(Fe)}),r.$$set=s=>{"connectionError"in s&&e(0,o=s.connectionError)},[o,l]}class Pe extends fe{constructor(t){super();de(this,t,Be,De,_e,{connectionError:0})}}var Je={1e3:"TW_ERROR_WRITING_TO_SOCKET",1001:"TW_SOCKET_INIT_ERROR",1002:"TW_INVALID_SSL_CERT",1003:"TW_SOCKET_NOT_FOUND",1004:"TW_HOST_NOT_FOUND",1005:"TW_ERROR_CREATING_SSL_CTX",1006:"TW_ERROR_CONNECTING_TO_PROXY",1007:"TW_TIMEOUT_READING_FROM_SOCKET",1008:"TW_ERROR_READING_RESPONSE",1009:"TW_INVALID_PROXY_CREDENTIALS",1010:"TW_UNSUPPORTED_PROXY_AUTH_TYPE"};function ge(r,t,e){const o=r.slice();return o[35]=t[e],o[39]=e,o}function he(r,t,e){const o=r.slice();return o[35]=t[e],o}function Me(r){let t,e=r[3],o=[];for(let l=0;l<e.length;l+=1)o[l]=ve(ge(r,e,l));return{c(){for(let l=0;l<o.length;l+=1)o[l].c();t=oe()},m(l,n){for(let s=0;s<o.length;s+=1)o[s].m(l,n);O(l,t,n)},p(l,n){if(n[0]&393224){e=l[3];let s;for(s=0;s<e.length;s+=1){const p=ge(l,e,s);o[s]?o[s].p(p,n):(o[s]=ve(p),o[s].c(),o[s].m(t.parentNode,t))}for(;s<o.length;s+=1)o[s].d(1);o.length=e.length}},d(l){ke(o,l),l&&N(t)}}}function Ue(r){let t,e=r[3],o=[];for(let l=0;l<e.length;l+=1)o[l]=ye(he(r,e,l));return{c(){for(let l=0;l<o.length;l+=1)o[l].c();t=oe()},m(l,n){for(let s=0;s<o.length;s+=1)o[s].m(l,n);O(l,t,n)},p(l,n){if(n[0]&8){e=l[3];let s;for(s=0;s<e.length;s+=1){const p=he(l,e,s);o[s]?o[s].p(p,n):(o[s]=ye(p),o[s].c(),o[s].m(t.parentNode,t))}for(;s<o.length;s+=1)o[s].d(1);o.length=e.length}},d(l){ke(o,l),l&&N(t)}}}function ve(r){let t,e,o,l,n,s,p,B,k,C;function m(){return r[24](r[39])}function R(...g){return r[25](r[39],...g)}return{c(){t=d("div"),e=d("button"),e.textContent="x",o=I(),l=d("button"),l.textContent="*",n=I(),s=d("textarea"),B=I(),u(e,"class","svelte-v88xr9"),u(l,"class","svelte-v88xr9"),s.value=p=r[35],u(s,"class","svelte-v88xr9"),u(t,"class","admin-episode svelte-v88xr9")},m(g,S){O(g,t,S),c(t,e),c(t,o),c(t,l),c(t,n),c(t,s),c(t,B),k||(C=[U(e,"click",m),U(l,"click",R),U(s,"input",r[26])],k=!0)},p(g,S){r=g,S[0]&8&&p!==(p=r[35])&&(s.value=p)},d(g){g&&N(t),k=!1,ie(C)}}}function ye(r){let t,e=r[35]+"",o;return{c(){t=d("cite"),o=w(e),u(t,"class","svelte-v88xr9")},m(l,n){O(l,t,n),c(t,o)},p(l,n){n[0]&8&&e!==(e=l[35]+"")&&j(o,e)},d(l){l&&N(t)}}}function Te(r){let t;return{c(){t=d("div"),t.textContent="Submitted string is likely gibberish.",u(t,"class","svelte-v88xr9")},m(e,o){O(e,t,o)},d(e){e&&N(t)}}}function qe(r){let t,e;return t=new Pe({props:{connectionError:r[9]}}),{c(){Ce(t.$$.fragment)},m(o,l){Re(t,o,l),e=!0},p(o,l){const n={};l[0]&512&&(n.connectionError=o[9]),t.$set(n)},i(o){e||(ce(t.$$.fragment,o),e=!0)},o(o){re(t.$$.fragment,o),e=!1},d(o){Ae(t,o)}}}function Ge(r){let t,e=r[0].length+"",o,l,n,s,p,B,k,C,m,R,g,S,b,E,h=r[11]&&Se(r);return{c(){t=d("div"),o=w(e),l=w(" / "),n=w(ne),s=I(),p=d("button"),B=w("Submit!"),C=I(),m=d("button"),R=w("Book"),g=I(),h&&h.c(),S=oe(),u(t,"id","counter"),x(t,"color",r[13]),x(t,"animation-name",r[12]),u(t,"class","svelte-v88xr9"),u(p,"type","submit"),p.disabled=k=r[4]&&!r[5],u(p,"class","svelte-v88xr9"),m.disabled=r[4],u(m,"class","svelte-v88xr9")},m(a,v){O(a,t,v),c(t,o),c(t,l),c(t,n),O(a,s,v),O(a,p,v),c(p,B),O(a,C,v),O(a,m,v),c(m,R),O(a,g,v),h&&h.m(a,v),O(a,S,v),b||(E=[U(p,"click",r[15]),U(m,"click",r[28])],b=!0)},p(a,v){v[0]&1&&e!==(e=a[0].length+"")&&j(o,e),v[0]&8192&&x(t,"color",a[13]),v[0]&4096&&x(t,"animation-name",a[12]),v[0]&48&&k!==(k=a[4]&&!a[5])&&(p.disabled=k),v[0]&16&&(m.disabled=a[4]),a[11]?h?h.p(a,v):(h=Se(a),h.c(),h.m(S.parentNode,S)):h&&(h.d(1),h=null)},i:Z,o:Z,d(a){a&&N(t),a&&N(s),a&&N(p),a&&N(C),a&&N(m),a&&N(g),h&&h.d(a),a&&N(S),b=!1,ie(E)}}}function Se(r){let t,e,o;return{c(){t=d("button"),t.textContent="Force submit",u(t,"id","force-submit-btn"),u(t,"type","submit"),u(t,"class","svelte-v88xr9")},m(l,n){O(l,t,n),e||(o=U(t,"click",r[19]),e=!0)},p:Z,d(l){l&&N(t),e=!1,o()}}}function Ee(r){let t,e,o=r[29](r[6])+"",l;return{c(){t=d("div"),e=w("Booked for: "),l=w(o),x(t,"float","right"),u(t,"class","svelte-v88xr9")},m(n,s){O(n,t,s),c(t,e),c(t,l)},p(n,s){s[0]&64&&o!==(o=n[29](n[6])+"")&&j(l,o)},d(n){n&&N(t)}}}function Ke(r){let t,e,o,l,n=r[10]/1e3+"",s,p,B,k,C,m,R,g,S,b,E,h,a,v,$,M,q,G,P,D,y,X,z,H,J,A,W,V,K,Q,ee;function te(_,F){return _[11]?Me:Ue}let f=te(r),i=f(r),T=r[7]&&Te();const le=[Ge,qe],Y=[];function ue(_,F){return _[8]?0:1}A=ue(r),W=Y[A]=le[A](r);let L=r[4]&&Ee(r);return{c(){t=d("main"),e=d("dialog"),o=d("p"),l=w("Booking allows you to prevent other users from submitting their episodes for a short period of time. ("),s=w(n),p=w(" seconds)"),B=I(),k=d("center"),C=d("button"),C.textContent="Book!",m=I(),R=d("span"),R.textContent="\xA0",g=I(),S=d("button"),S.textContent="Cancel",b=I(),E=d("center"),h=d("h1"),h.textContent="Storytelling experiment",a=I(),v=d("p"),v.textContent="TODO: add description",$=I(),M=d("br"),q=I(),G=d("blockquote"),i.c(),P=I(),D=d("div"),y=d("textarea"),z=I(),T&&T.c(),H=I(),J=d("div"),W.c(),V=I(),L&&L.c(),u(o,"class","svelte-v88xr9"),u(C,"class","svelte-v88xr9"),u(R,"class","svelte-v88xr9"),u(S,"class","svelte-v88xr9"),u(k,"class","svelte-v88xr9"),e.open=r[2],u(e,"class","svelte-v88xr9"),u(h,"class","svelte-v88xr9"),u(v,"class","svelte-v88xr9"),u(M,"class","svelte-v88xr9"),y.disabled=X=!r[8]&&!r[0].length,u(y,"placeholder","Your piece of the story!"),u(y,"type","text"),u(y,"class","svelte-v88xr9"),u(J,"id","submit-region"),u(J,"class","svelte-v88xr9"),u(D,"class","svelte-v88xr9"),u(G,"class","svelte-v88xr9"),u(E,"class","svelte-v88xr9"),u(t,"class","svelte-v88xr9")},m(_,F){O(_,t,F),c(t,e),c(e,o),c(o,l),c(o,s),c(o,p),c(e,B),c(e,k),c(k,C),c(k,m),c(k,R),c(k,g),c(k,S),c(t,b),c(t,E),c(E,h),c(E,a),c(E,v),c(E,$),c(E,M),c(E,q),c(E,G),i.m(G,null),c(G,P),c(G,D),c(D,y),me(y,r[0]),c(D,z),T&&T.m(D,null),c(D,H),c(D,J),Y[A].m(J,null),c(J,V),L&&L.m(J,null),r[30](E),K=!0,Q||(ee=[U(C,"click",r[16]),U(S,"click",r[23]),U(y,"input",r[27]),U(y,"input",r[14])],Q=!0)},p(_,F){(!K||F[0]&1024)&&n!==(n=_[10]/1e3+"")&&j(s,n),(!K||F[0]&4)&&(e.open=_[2]),f===(f=te(_))&&i?i.p(_,F):(i.d(1),i=f(_),i&&(i.c(),i.m(G,P))),(!K||F[0]&257&&X!==(X=!_[8]&&!_[0].length))&&(y.disabled=X),F[0]&1&&me(y,_[0]),_[7]?T||(T=Te(),T.c(),T.m(D,H)):T&&(T.d(1),T=null);let se=A;A=ue(_),A===se?Y[A].p(_,F):(Ne(),re(Y[se],1,1,()=>{Y[se]=null}),Oe(),W=Y[A],W?W.p(_,F):(W=Y[A]=le[A](_),W.c()),ce(W,1),W.m(J,V)),_[4]?L?L.p(_,F):(L=Ee(_),L.c(),L.m(J,null)):L&&(L.d(1),L=null)},i(_){K||(ce(W),K=!0)},o(_){re(W),K=!1},d(_){_&&N(t),i.d(),T&&T.d(),Y[A].d(),L&&L.d(),r[30](null),Q=!1,ie(ee)}}}const Ye="ws://217.15.202.178:8013/story",ne=140,ae=150;function Xe(r,t,e){let o,l,n="",s=-1;const p=f=>{const i=f.target.value.replaceAll(/[^A-Za-z0-9.,!?":\- ]/g,"");if(n.length>=ne&&s===-1&&(s=n.split(" ").length),n.length<ne&&(s=-1),s===-1)e(0,n=i);else if(i.split(" ").length>=s){const T=i.split(" ").slice(0,s).join(" ");e(0,n=T.substr(0,ae))}};let B=[],k=!1,C=!1,m=null,R=null,g=localStorage.getItem("st-bookid");console.log("bookId",g);let S=!1,b=null,E=!1,h=null,a=-1;const v=()=>{e(20,b=new WebSocket(Ye)),b.addEventListener("message",f=>{const i=JSON.parse(f.data);switch(i.type){case"update":i.data.bookDuration&&e(10,a=i.data.bookDuration),e(3,B=i.data.episodes),e(4,k=i.isBooked),e(5,C=i.data.bookedForMe),e(6,m=i.data.bookedFor),clearInterval(R),m>0&&(R=setInterval(()=>{e(6,m-=1e3)},1e3));break;case"submitSuccess":e(0,n="");break;case"bookSuccess":e(4,k=!0),e(5,C=!0),g=i.data,localStorage.setItem("st-bookid",g),console.log("you booked",g);break;case"booked":e(4,k=!0),e(6,m=i.data.bookedFor),localStorage.setItem("st-booked-for",m.toString()),console.log("someone booked for",m),R=setInterval(()=>{e(6,m-=1e3)},1e3);break;case"unbooked":e(4,k=!1),g=null,e(6,m=0),clearInterval(R),localStorage.setItem("st-booked-for",m.toString()),localStorage.setItem("st-bookid","false"),console.log("unbooked");break;case"error":e(7,S=i.data==="gibberish"),console.error(i.data);break;case"bookTimeQuery":e(10,a=i.data);break;case"adminAttempt":i.data===!0?(alert("admin access granted"),e(11,D=!0)):alert("admin access denied");break}}),b.addEventListener("open",()=>{b.send(JSON.stringify({type:"get",bookId:g})),e(8,E=!0),e(9,h=null)}),b.addEventListener("close",f=>{var i;setTimeout(v,2500),e(8,E=!1),e(9,h=`Error: ${(i=Je[f.code])!=null?i:f.code}`)})};pe(v),be(()=>{b==null||b.close(),e(20,b=null),clearInterval(R)});const $=()=>{e(7,S=!1),b.send(JSON.stringify({type:"submit",bookId:g,data:n}))};let M,q=!1;const G=()=>{e(2,q=!1),b.send(JSON.stringify({type:"book",bookId:g}))};let P=!1,D=!1,y=null;const X=f=>{console.log("removed",f),b.send(JSON.stringify({type:"deleteLine",data:f,pwd:y}))},z=(f,i)=>{const T=i.currentTarget;T.classList.add("used"),setTimeout(()=>{T.classList.remove("used"),T.innerText="*"},1e3),T.innerText="\u2714",console.log("edited",f);const le=i.currentTarget.parentElement.querySelector("textarea").value;b.send(JSON.stringify({type:"replaceLine",data:{i:f,line:le},pwd:y}))},H=()=>{b.send(JSON.stringify({type:"forceSubmit",data:n,pwd:y}))},J=()=>e(2,q=!1),A=f=>X(f),W=(f,i)=>z(f,i),V=f=>f.currentTarget.value=f.currentTarget.value.substr(0,ae);function K(){n=this.value,e(0,n),e(21,P),e(20,b),e(22,y)}const Q=()=>e(2,q=!0),ee=f=>`${Math.floor(f/1e3/60)}  minutes ${Math.floor(f/1e3%60)} seconds`;function te(f){Ie[f?"unshift":"push"](()=>{M=f,e(1,M),e(2,q),e(21,P),e(0,n),e(20,b),e(22,y)})}return r.$$.update=()=>{r.$$.dirty[0]&7340033&&(e(21,P=n==='"""veeryseecreet"!""'),P&&(e(0,n=""),e(22,y=prompt("Enter password")),b.send(JSON.stringify({type:"admin",data:y})),e(21,P=!1))),r.$$.dirty[0]&1&&e(13,o=n.length===ae?"red":"unset"),r.$$.dirty[0]&1&&e(12,l=n.length>ne?"vibrate":""),r.$$.dirty[0]&2097158&&M&&e(1,M.style.pointerEvents=q||P?"none":null,M)},[n,M,q,B,k,C,m,S,E,h,a,D,l,o,p,$,G,X,z,H,b,P,y,J,A,W,V,K,Q,ee,te]}class je extends fe{constructor(t){super();de(this,t,Xe,Ke,_e,{},null,[-1,-1])}}new je({target:document.body});
